
<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8"/>
<meta name="viewport" content="width=device-width,initial-scale=1"/>
<title>Idol Explorer - Minu's Festive Learning</title>
<style>
  :root{--bg:#0b1220; --card:#fff; --accent:#ffd54a; --muted:#94a3b8;}
  body{margin:0;font-family:Inter,system-ui,Segoe UI,Roboto,Arial;background:var(--bg);color:#fff;display:flex;flex-direction:column;align-items:center;padding:12px}
  .wrap{width:100%;max-width:980px}
  header{display:flex;justify-content:space-between;align-items:center;gap:12px}
  h1{font-size:18px;margin:0}
  .modes{display:flex;gap:8px}
  .btn{background:var(--accent);color:#071126;padding:8px 12px;border-radius:10px;border:none;font-weight:700}
  .card{background:var(--card);color:#071122;border-radius:12px;padding:12px;margin-top:12px}
  .imgWrap{position:relative;border-radius:10px;overflow:hidden;background:#eee}
  #idol{width:100%;height:auto;display:block;touch-action:none;-webkit-user-drag:none}
  .hotspot{position:absolute;transform:translate(-50%,-50%);border-radius:50%;width:56px;height:56px;display:flex;align-items:center;justify-content:center;pointer-events:auto;z-index:30}
  .hs-dot{width:30px;height:30px;border-radius:50%;background:rgba(255,213,74,0.95);box-shadow:0 4px 12px rgba(0,0,0,0.25);display:flex;align-items:center;justify-content:center}
  .hs-dot img{width:22px;height:22px}
  .infoPopup{position:absolute;left:50%;top:6%;transform:translateX(-50%);background:var(--card);color:#071122;padding:12px;border-radius:10px;box-shadow:0 8px 30px rgba(2,6,23,0.12);max-width:360px;display:none;z-index:50}
  .controls{display:flex;gap:8px;flex-wrap:wrap;margin-top:10px;align-items:center}
  .progress{margin-top:8px;color:var(--muted);font-size:13px}
  .collection{display:flex;gap:8px;flex-wrap:wrap;margin-top:10px}
  .badge{background:#fff;color:#071122;padding:6px 8px;border-radius:8px;font-weight:700;border:2px solid rgba(11,18,32,0.05)}
  .footer{margin-top:12px;color:var(--muted);font-size:13px}
  .overlay{position:fixed;inset:0;display:none;align-items:center;justify-content:center;background:rgba(0,0,0,0.6);z-index:200}
  .popup{background:var(--card);color:#071122;padding:18px;border-radius:12px;text-align:center;max-width:360px}
  input[type="text"]{padding:8px;border-radius:8px;border:1px solid #e6e9ef;width:100%;box-sizing:border-box}
  .lang{background:#eef2ff;color:#071122;padding:6px 8px;border-radius:8px;border:1px solid:#dee6fb}
</style>
</head>
<body>
<div class="wrap">
  <header>
    <div>
      <h1 id="pageTitle">Idol Explorer - Discover Maa Durga</h1>
      <div style="color:var(--muted);font-size:13px" id="subtitle">Tap hotspots to learn - collect badges & get blessings</div>
    </div>
    <div style="display:flex;align-items:center;gap:8px">
      <select id="langSel" class="lang">
        <option value="en">English</option>
        <option value="hi">हिन्दी</option>
        <option value="bn">বাংলা</option>
      </select>
      <div class="modes">
        <button class="btn" id="modeSawari">Sawari Search</button>
        <button class="btn" id="modeWeapon">Weapon Search</button>
        <button class="btn" id="modeGod">God Search</button>
      </div>
    </div>
  </header>

  <div class="card">
    <div style="display:flex;gap:12px;align-items:center;justify-content:space-between;flex-wrap:wrap">
      <div style="flex:1">
        <div style="font-weight:700">Current Mode: <span id="currentMode">Sawari Search</span></div>
        <div class="progress" id="progressText">Find the sawari (vehicles) for the deities.</div>
      </div>
      <div style="min-width:240px">
        <label style="font-size:12px;color:var(--muted)">Child name (optional)</label>
        <input type="text" id="childName" placeholder="Type name to include on certificate">
      </div>
    </div>

    <div style="margin-top:12px;position:relative">
      <div class="imgWrap" id="imgWrap">
        <img id="idol" src="assets/durga.jpg" alt="Durga Idol">
        <div id="infoPopup" class="infoPopup"></div>
      </div>
    </div>

    <div class="controls">
      <button class="btn" id="showCollection">My Collection</button>
      <button class="btn" id="downloadCert">Download Certificate</button>
      <button class="btn" id="playBlessing">Play Blessing</button>
      <div style="flex:1"></div>
      <div style="color:var(--muted);font-size:13px">Mode hints: <span id="modeHint">Find the vehicles</span></div>
    </div>

    <div class="collection" id="collectionArea" aria-live="polite"></div>
  </div>

  <div class="footer">Designed by Minu's Robotics & Coding - educational & respectful. Use with supervision at the pandal.</div>
</div>

<div class="overlay" id="overlay">
  <div class="popup" id="popup">
    <div id="popupInner"></div>
    <div style="margin-top:12px"><button class="btn" id="closePopup">Close</button></div>
  </div>
</div>

<script>
const HOTSPOTS = {{"sawari": [{"id": "lion", "x": 0.51, "y": 0.61, "label": "Lion (Durga's Sawari)", "story": "Maa Durga rides the lion. It symbolizes courage and power.", "icon": "assets/lion.png"}, {"id": "mouse", "x": 0.12, "y": 0.78, "label": "Mouse (Ganesha's Sawari)", "story": "Ganesha's vehicle is the mouse \u2014 clever and quick.", "icon": "assets/mouse.png"}, {"id": "peacock", "x": 0.9, "y": 0.78, "label": "Peacock (Kartikeya's Sawari)", "story": "Kartikeya often rides a peacock, symbolizing beauty and pride.", "icon": "assets/peacock.png"}], "weapons": [{"id": "trishul", "x": 0.52, "y": 0.28, "label": "Trishul (Trident)", "story": "The Trishul destroys evil and ignorance.", "icon": "assets/trishul.png"}, {"id": "sword", "x": 0.42, "y": 0.3, "label": "Sword", "story": "The sword represents knowledge which cuts through falsehood.", "icon": "assets/sword.png"}, {"id": "lotus", "x": 0.6, "y": 0.3, "label": "Lotus", "story": "The lotus stands for purity and spiritual consciousness.", "icon": "assets/lotus.png"}], "gods": [{"id": "ganesha", "x": 0.08, "y": 0.48, "label": "Ganesha", "story": "Ganesha is the remover of obstacles and lord of beginnings.", "icon": "assets/ganesha.png"}, {"id": "lakshmi", "x": 0.28, "y": 0.46, "label": "Lakshmi", "story": "Lakshmi is goddess of wealth and prosperity.", "icon": "assets/lakshmi.png"}, {"id": "durga", "x": 0.5, "y": 0.18, "label": "Durga", "story": "Maa Durga is a powerful mother goddess who defeats evil.", "icon": "assets/lion.png"}, {"id": "saraswati", "x": 0.72, "y": 0.46, "label": "Saraswati", "story": "Saraswati is goddess of knowledge, music, and arts.", "icon": "assets/saraswati.png"}, {"id": "kartikeya", "x": 0.92, "y": 0.46, "label": "Kartikeya", "story": "Kartikeya is a warrior god and commander of the gods.", "icon": "assets/kartikeya.png"}]}};
const TEXTS = {{"en": {"title": "Idol Explorer - Discover Maa Durga", "findVehicles": "Find the vehicles (sawari) of the deities.", "findWeapons": "Tap each weapon to learn.", "findGods": "Find the gods by name.", "collectionTitle": "My Collection", "downloadCert": "Download Certificate", "playBlessing": "Play Blessing"}, "hi": {"title": "\u092e\u0942\u0930\u094d\u0924\u093f \u0905\u0928\u094d\u0935\u0947\u0937\u0915 - \u092e\u093e\u0902 \u0926\u0941\u0930\u094d\u0917\u093e \u0916\u094b\u091c\u0947\u0902", "findVehicles": "\u0926\u0947\u0935\u0924\u093e\u0913\u0902 \u0915\u0947 \u0935\u093e\u0939\u0928 \u0916\u094b\u091c\u0947\u0902\u0964", "findWeapons": "\u092a\u094d\u0930\u0924\u094d\u092f\u0947\u0915 \u0939\u0925\u093f\u092f\u093e\u0930 \u092a\u0930 \u091f\u0948\u092a \u0915\u0930\u0947\u0902 \u0914\u0930 \u091c\u093e\u0928\u0947\u0902\u0964", "findGods": "\u0926\u0947\u0935\u0924\u093e\u0913\u0902 \u0915\u0947 \u0928\u093e\u092e \u092c\u0924\u093e\u0907\u090f\u0964", "collectionTitle": "\u092e\u0947\u0930\u0940 \u0938\u0902\u0917\u094d\u0930\u0939", "downloadCert": "\u092a\u094d\u0930\u092e\u093e\u0923\u092a\u0924\u094d\u0930 \u0921\u093e\u0909\u0928\u0932\u094b\u0921 \u0915\u0930\u0947\u0902", "playBlessing": "\u0906\u0936\u0940\u0930\u094d\u0935\u093e\u0926 \u0938\u0941\u0928\u093e\u090f\u0901"}, "bn": {"title": "\u09ae\u09c2\u09b0\u09cd\u09a4\u09bf \u098f\u0995\u09cd\u09b8\u09aa\u09cd\u09b2\u09cb\u09b0\u09be\u09b0 - \u09ae\u09be \u09a6\u09c1\u09b0\u09cd\u0997\u09be \u099c\u09be\u09a8\u09c1\u09a8", "findVehicles": "\u09a6\u09c7\u09ac\u09a4\u09be\u09a6\u09c7\u09b0 \u09ac\u09be\u09b9\u09a8\u0997\u09c1\u09b2\u09bf\u0995\u09c7 \u0996\u09c1\u0981\u099c\u09c1\u09a8\u0964", "findWeapons": "\u09aa\u09cd\u09b0\u09a4\u09bf\u099f\u09bf \u0985\u09b8\u09cd\u09a4\u09cd\u09b0\u09c7 \u099f\u09cd\u09af\u09be\u09aa \u0995\u09b0\u09c7 \u099c\u09be\u09a8\u09c1\u09a8\u0964", "findGods": "\u09a6\u09c7\u09ac\u09a4\u09be\u09a6\u09c7\u09b0 \u09a8\u09be\u09ae \u0996\u09c1\u0981\u099c\u09c7 \u09ac\u09c7\u09b0 \u0995\u09b0\u09c1\u09a8\u0964", "collectionTitle": "\u0986\u09ae\u09be\u09b0 \u09b8\u0982\u0997\u09cd\u09b0\u09b9", "downloadCert": "\u09b8\u09be\u09b0\u09cd\u099f\u09bf\u09ab\u09bf\u0995\u09c7\u099f \u09a1\u09be\u0989\u09a8\u09b2\u09cb\u09a1 \u0995\u09b0\u09c1\u09a8", "playBlessing": "\u0986\u09b6\u09c0\u09b0\u09cd\u09ac\u09be\u09a6 \u09b6\u09c1\u09a8\u09c1\u09a8"}}};
</script>

<script>
// state and DOM
let mode = 'sawari';
let found = {sawari: new Set(), weapons: new Set(), gods: new Set()};
const imgWrap = document.getElementById('imgWrap');
const idolImg = document.getElementById('idol');
const infoPopup = document.getElementById('infoPopup');
const progressText = document.getElementById('progressText');
const currentModeEl = document.getElementById('currentMode');
const modeHint = document.getElementById('modeHint');
const collectionArea = document.getElementById('collectionArea');
const overlay = document.getElementById('overlay');
const popupInner = document.getElementById('popupInner');
const langSel = document.getElementById('langSel');

document.getElementById('modeSawari').addEventListener('click', ()=> setMode('sawari'));
document.getElementById('modeWeapon').addEventListener('click', ()=> setMode('weapons'));
document.getElementById('modeGod').addEventListener('click', ()=> setMode('gods'));
document.getElementById('closePopup').addEventListener('click', ()=> { overlay.style.display='none'; });
document.getElementById('showCollection').addEventListener('click', showCollection);
document.getElementById('downloadCert').addEventListener('click', downloadCertificate);
document.getElementById('playBlessing').addEventListener('click', playBlessing);
langSel.addEventListener('change', ()=> applyLang(langSel.value));

function applyLang(code){
  const t = TEXTS[code] || TEXTS['en'];
  document.getElementById('pageTitle').textContent = t.title;
  document.getElementById('modeHint').textContent = (mode==='sawari')? t.findVehicles : (mode==='weapons')? t.findWeapons : t.findGods;
  document.getElementById('downloadCert').textContent = t.downloadCert;
  document.getElementById('playBlessing').textContent = t.playBlessing;
}

function makeHotspot(h){
  const el = document.createElement('div');
  el.className='hotspot';
  el.style.left = (h.x*100)+'%'; el.style.top=(h.y*100)+'%';
  const dot = document.createElement('div'); dot.className='hs-dot';
  const img = document.createElement('img'); img.src = h.icon || 'assets/lion.png';
  dot.appendChild(img); el.appendChild(dot);
  el.addEventListener('click', (ev)=> { ev.stopPropagation(); onHotspotClick(h); });
  return el;
}

function renderHotspots(){
  Array.from(imgWrap.querySelectorAll('.hotspot')).forEach(n=>n.remove());
  const set = HOTSPOTS[mode];
  set.forEach(h=>{ imgWrap.appendChild(makeHotspot(h)); });
  updateProgress();
}

function onHotspotClick(h){
  infoPopup.style.display='block';
  infoPopup.innerHTML = `<div style="font-weight:800">${h.label}</div><div style="margin-top:6px;font-size:13px;color:#374151">${h.story}</div><div style="margin-top:8px;display:flex;gap:8px;justify-content:center"><button class="btn" id="learnMore">Learn More</button><button class="btn" id="closeInfo">Close</button></div>`;
  speakText(h.label + '. ' + h.story);
  document.getElementById('learnMore').onclick = ()=> { overlay.style.display='flex'; popupInner.innerHTML = `<div style="font-weight:800">${h.label}</div><div style="margin-top:8px;text-align:left">${h.story}</div>`; };
  document.getElementById('closeInfo').onclick = ()=> { infoPopup.style.display='none'; };
  markFound(h);
}

function markFound(h){
  if(mode==='sawari') found.sawari.add(h.id);
  if(mode==='weapons') found.weapons.add(h.id);
  if(mode==='gods') found.gods.add(h.id);
  addBadge(h);
  updateProgress();
  const total = HOTSPOTS[mode].length;
  const got = (mode==='sawari')? found.sawari.size : (mode==='weapons')? found.weapons.size : found.gods.size;
  if(got >= total){
    playBlessing();
    setTimeout(()=> { overlay.style.display='flex'; popupInner.innerHTML = `<div style="font-weight:900;font-size:18px">Congratulations!</div><div style="margin-top:8px">You completed ${mode} and unlocked all badges.</div>`; try{ if(window.onSuccess) window.onSuccess({mode:mode, item:'ALL', childName:document.getElementById('childName').value||null}); }catch(e){} }, 600);
  }
}

function addBadge(h){
  const key = mode + '-' + h.id;
  if(document.getElementById(key)) return;
  const b = document.createElement('div'); b.className='badge'; b.id=key;
  b.innerHTML = `<img src="${h.icon}" style="width:28px;height:28px;vertical-align:middle;margin-right:6px"/>${h.label}`;
  collectionArea.appendChild(b);
}

function updateProgress(){
  currentModeEl.textContent = mode.charAt(0).toUpperCase() + mode.slice(1);
  const got = (mode==='sawari')? found.sawari.size : (mode==='weapons')? found.weapons.size : found.gods.size;
  const total = HOTSPOTS[mode].length;
  const t = TEXTS[langSel.value] || TEXTS['en'];
  modeHint.textContent = (mode==='sawari')? t.findVehicles : (mode==='weapons')? t.findWeapons : t.findGods;
  progressText.textContent = `Found ${got} of ${total} in ${mode}.`;
}

function showCollection(){
  overlay.style.display='flex';
  const items = Array.from(collectionArea.children).map(n=>n.textContent);
  popupInner.innerHTML = `<div style="font-weight:900">${TEXTS[langSel.value].collectionTitle}</div><div style="margin-top:8px;text-align:left">${items.length? items.map(x=>`<div>• ${x}</div>`).join('') : '<div>No badges yet — find hotspots to collect badges.</div>'}</div>`;
}

function downloadCertificate(){
  const child = document.getElementById('childName').value || 'Young Explorer';
  const items = Array.from(collectionArea.children).map(n=>n.textContent);
  const canvas = document.createElement('canvas'); canvas.width=1200; canvas.height=675;
  const ctx = canvas.getContext('2d');
  ctx.fillStyle='#fff'; ctx.fillRect(0,0,canvas.width,canvas.height);
  ctx.fillStyle='#071122'; ctx.font='36px sans-serif'; ctx.fillText('Certificate of Exploration',50,70);
  ctx.font='24px sans-serif'; ctx.fillText(`Awarded to: ${child}`,50,120);
  ctx.font='18px sans-serif'; ctx.fillText(`For learning about: ${mode}`,50,160);
  ctx.fillStyle='#444'; ctx.font='16px sans-serif';
  let y=210;
  if(items.length){ ctx.fillText('Badges collected:',50,y); y+=28; items.forEach(it=>{ ctx.fillText('• '+it,64,y); y+=26; }); } else { ctx.fillText('No badges collected yet. Play the game to collect them!',50,y); }
  ctx.fillStyle='#777'; ctx.font='14px sans-serif'; ctx.fillText("Minu's Robotics & Coding - Happy Puja!",50,canvas.height-40);
  const url = canvas.toDataURL('image/png'); const a=document.createElement('a'); a.href=url; a.download=`certificate-${child.replace(/\s+/g,'_')}.png`; a.click();
}

function playBlessing(){
  const child = document.getElementById('childName').value || 'Young explorer';
  const lang = langSel.value || 'en';
  const msg_en = `Blessings to ${child}. May Maa Durga bless you with courage and knowledge.`;
  const msg_hi = `${child} जी, माँ दुर्गा आपको साहस और ज्ञान का आशीर्वाद दें।`;
  const msg_bn = `${child}, মা দুর্গা তোমাকে সাহস ও জ্ঞানের আশীর্বাদ দিন।`;
  const msg = (lang==='hi')? msg_hi : (lang==='bn')? msg_bn : msg_en;
  speakText(msg, lang);
}

function speakText(text, lang){
  try{ const u = new SpeechSynthesisUtterance(text); u.lang = (lang==='hi')? 'hi-IN' : (lang==='bn')? 'bn-IN' : 'en-IN'; window.speechSynthesis.cancel(); window.speechSynthesis.speak(u); }catch(e){ console.log('TTS not supported', e); }
}

function capitalize(s){ return s.charAt(0).toUpperCase() + s.slice(1); }

function setMode(m){ mode = m; infoPopup.style.display='none'; renderHotspots(); updateProgress(); applyLang(langSel.value || 'en'); }

function init(){ idolImg.onload = ()=> { setMode('sawari'); }; document.body.addEventListener('click', ()=> { infoPopup.style.display='none'; }); applyLang('en'); }

init();

window.onSuccess = window.onSuccess || function(data){ console.log('IdolExplorer onSuccess', data); };

</script>
</body>
</html>
